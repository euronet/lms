--- lib/LMS.class.php	2014-05-15 10:50:25.000000000 +0200
+++ lib/LMS.class.php	2014-07-17 14:22:33.033581000 +0200
@@ -4175,7 +4175,7 @@
 			ORDER BY name', array($id, $id, $id, $id, $id));
 	}
 
-	public function GetNetDevList($order = 'name,asc') {
+	public function GetNetDevList($order = 'name,asc', $gponolt=0) {
 		list($order, $direction) = sscanf($order, '%[^,],%s');
 
 		($direction == 'desc') ? $direction = 'desc' : $direction = 'asc';
@@ -4207,12 +4207,17 @@
 				break;
 		}
 
+		$where=' WHERE 1=1 ';
+		if($gponolt==1)
+		{
+			$where.=' AND gponoltid>0';
+		}
 		$netdevlist = $this->DB->GetAll('SELECT d.id, d.name, d.location,
 			d.description, d.producer, d.model, d.serialnumber, d.ports,
 			(SELECT COUNT(*) FROM nodes WHERE netdev=d.id AND ownerid > 0)
 			+ (SELECT COUNT(*) FROM netlinks WHERE src = d.id OR dst = d.id)
-			AS takenports
-			FROM netdevices d '
+			AS takenports, d.gponoltid
+			FROM netdevices d '.$where
 				. ($sqlord != '' ? $sqlord . ' ' . $direction : ''));
 
 		$netdevlist['total'] = sizeof($netdevlist);
@@ -4374,15 +4379,16 @@
 			'community' => $data['community'],
 			'channelid' => !empty($data['channelid']) ? $data['channelid'] : NULL,
 			'longitude' => !empty($data['longitude']) ? str_replace(',', '.', $data['longitude']) : NULL,
-			'latitude' => !empty($data['latitude']) ? str_replace(',', '.', $data['latitude']) : NULL
+			'latitude' => !empty($data['latitude']) ? str_replace(',', '.', $data['latitude']) : NULL,
+			'gponoltid' => $data['gponoltid']
 		);
 		if ($this->DB->Execute('INSERT INTO netdevices (name, location,
 				location_city, location_street, location_house, location_flat,
 				description, producer, model, serialnumber,
 				ports, purchasetime, guaranteeperiod, shortname,
 				nastype, clients, secret, community, channelid,
-				longitude, latitude)
-				VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', array_values($args))) {
+				longitude, latitude, gponoltid)
+				VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)', array_values($args))) {
 			$id = $this->DB->GetLastInsertID('netdevices');
 
 			// EtherWerX support (devices have some limits)
